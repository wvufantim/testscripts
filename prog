#!/bin/bash

if [[ ! -f /home/$USER/bin/Programs.csv ]]; then
    # Create the Programs file if it does not already exist
    mkdir -p /home/$USER/bin
    touch /home/$USER/bin/Programs.csv
    echo "Type, Name" >> /home/$USER/bin/Programs.csv
    echo "Programs, to add" >> /home/$USER/bin/Programs.csv
    echo "Programs, to remove" >> /home/$USER/bin/Programs.csv
    echo "Flatpaks, to add" >> /home/$USER/bin/Programs.csv
    echo "Flatpaks, to remove" >> /home/$USER/bin/Programs.csv
fi

# Check if flatpak is already installed. If not, install it.
if ! command -v flatpak > /dev/null; then
    echo "flatpak is not installed, installing it now..."
    sudo apt-get install -y flatpak
fi

# Install programs and flatpaks listed in the Programs file
while IFS="," read -r type name; do
    if [[ $type == "Type" ]] || [[ $name == "Name" ]]; then
        continue
    fi
    if [[ $type == "Flatpaks" ]]; then
        if [[ $name == "-*" ]]; then
            flatpak uninstall -y ${name:1}
        else
            flatpak install -y $name
        fi
    else
        if [[ $name == "-*" ]]; then
            sudo apt-get remove -y ${name:1}
        else
            sudo apt-get install -y $name
        fi
    fi
done < /home/$USER/bin/Programs.csv
